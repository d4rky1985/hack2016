{% extends '::base.html.twig' %}

{% block page %}
<div data-role="page" class="jqm-demos jqm-home" id="page_index" class="page_index">

    {% include '::includes/header.html.twig' %}
    <div role="main" class="ui-content jqm-content">
        <form class="ui-filterable">
            <input id="autocomplete-input" data-type="search" placeholder="Add a product...">
        </form>
        <ul id="autocomplete" data-role="listview" data-inset="true" data-filter="true" data-input="#autocomplete-input"></ul>
    </div><!-- /content -->
    {% include '::includes/menu.html.twig' %}
{% include '::includes/footer.html.twig' %}

    <script language="JavaScript">
        $( document ).on( "pagecreate", "#page_index", function() {
            $( "#autocomplete" ).on( "filterablebeforefilter", function ( e, data ) {
                var $ul = $( this ),
                        $input = $( data.input ),
                        value = $input.val(),
                        html = "";
                $ul.html( "" );
                if ( value && value.length > 2 ) {
                    $ul.html( "<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>" );
                    $ul.listview( "refresh" );
                    $.ajax({
                                url: "http://gd.geobytes.com/AutoCompleteCity",
                                dataType: "jsonp",
                                crossDomain: true,
                                data: {
                                    q: $input.val()
                                }
                            })
                            .then( function ( response ) {
                                $.each( response, function ( i, val ) {
                                    html += "<li><a href='#'>" + val + "</a></li>";
                                });
                                $ul.html( html );
                                $ul.listview( "refresh" );
                                $ul.trigger( "updatelayout");
                            });
                }
            });
        });
    </script>
</div><!-- /page -->
{% endblock %}